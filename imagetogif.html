<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Image GIF Creator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Multi-Image GIF Creator</h1>
        <input type="file" id="imageInput" accept="image/*" multiple>
        <div id="imagePreview" class="mt-3"></div>
        <div class="mt-3">
            <label for="delayInput">Delay (0ms to 1000ms):</label>
            <input type="number" class="form-control" id="delayInput" min="0" max="1000" value="200">
        </div>
        <div class="mt-3">
            <label for="repeatInput">Repeat Count (leave blank for infinity):</label>
            <input type="number" class="form-control" id="repeatInput" min="0">
        </div>
        <button id="createGIF" class="btn btn-primary mt-3">Create GIF</button>
        <div id="gifResult" class="mt-3"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="./gif.js"></script>
    <script src="./gif.worker.js"></script>
    <script>
        $(document).ready(function () {
            var imageArray = [];

            $('#imageInput').change(function () {
                var files = $(this)[0].files;

                $('#imagePreview').empty();

                for (var i = 0; i < files.length; i++) {
                    var file = files[i];
                    if (!file.type.match('image.*')) {
                        continue;
                    }
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = new Image();
                        img.onload = function () {
                            $('#imagePreview').append('<img src="' + img.src + '" class="img-thumbnail mr-2" width="100">');
                            imageArray.push(img);
                        };
                        img.onerror = function () {
                            console.error('Error loading image: ' + file.name);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            $('#createGIF').click(function () {
                if (imageArray.length === 0) {
                    alert('Please select images first.');
                    return;
                }

                var delay = $('#delayInput').val().trim() === '' ? 0 : parseInt($('#delayInput').val());
                var repeatCount = $('#repeatInput').val().trim() === '' ? undefined : parseInt($('#repeatInput').val());

                var gif = new GIF({
                    workers: 2,
                    quality: 10,
                    repeat: repeatCount // Setting repeat count directly in the constructor
                });

                imageArray.forEach(function (image, index) {
                    gif.addFrame(image, { delay: delay });
                });

                gif.on('finished', function (blob) {
                    var url = URL.createObjectURL(blob);
                    $('#gifResult').html('<img src="' + url + '" class="img-fluid">');
                });

                gif.render();
            });
        });

    </script>

</body>

</html>
