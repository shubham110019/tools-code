<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>JSON Formatter & Validator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism-okaidia.min.css">
    <style>
        #output {
            border: 1px solid #ccc;
            padding: 10px;
            position: relative;
            overflow-x: auto;
            /* Enable horizontal scrolling */
            background-color: #333;
            /* Dark background */
            color: #fff;
            /* Text color */
        }

        .error {
            color: red;
        }

        .copy-btn {
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .clear-btn {
            margin-left: 5px;
        }

        /* Media query for responsiveness */
        @media screen and (max-width: 600px) {
            #output {
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>JSON Formatter & Validator</h1>
        <textarea id="jsonInput" class="form-control" placeholder="Enter JSON here"></textarea>
        <button onclick="formatAndValidate()" class="btn btn-primary mt-3">Format & Validate</button>
        <button onclick="clearFields()" class="btn btn-secondary mt-3 clear-btn">Clear</button>
        <button onclick="saveFormattedJSON()" class="btn btn-success mt-3">Save Formatted JSON</button>
        <div id="output" class="mt-3"></div>
        <div id="error" class="mt-3 error"></div>
        <div id="mess" class="mt-3"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-json.min.js"></script>
    <script>
        function formatAndValidate() {
            const jsonInput = $('#jsonInput').val();
            if (jsonInput.trim() === '') {
                $('#error').empty().hide();
                return;
            }
            try {
                const parsedJSON = JSON.parse(jsonInput);
                const formattedJSON = JSON.stringify(parsedJSON, null, 2);
                const outputDiv = $('#output');
                outputDiv.html('<pre><code class="language-json">' + formattedJSON + '</code></pre>').removeClass('error');
                Prism.highlightAll(); // Apply Prism syntax highlighting

                clearErrors();
                showMessage('JSON is valid!');
                addCopyButton(outputDiv); // Add copy button
            } catch (error) {
                handleInvalidJSON(error);
            }
        }

        function addCopyButton(outputDiv) {
            const copyButton = $('<button class="btn btn-secondary copy-btn">Copy</button>');
            copyButton.on('click', function () {
                const copyText = outputDiv.find('pre').text();
                navigator.clipboard.writeText(copyText)
                    .then(() => {
                        copyButton.text('Copied');
                        setTimeout(() => {
                            copyButton.text('Copy');
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            });
            outputDiv.append(copyButton);
        }

        function clearFields() {
            $('#jsonInput').val('');
            $('#output').empty();
            clearErrors();
            $('#mess').empty().hide();
        }

        function clearErrors() {
            $('#error').empty().hide();
            $('#output').removeClass('error');
        }

        function handleInvalidJSON(error) {
            $('#output').empty().removeClass('error');
            $('#error').text('Invalid JSON: ' + error).show();
            $('#mess').empty().hide();
        }

        function showMessage(message) {
            $('#mess').text(message).removeClass('error').show();
        }

        $('#jsonInput').on('input', function () {
            const inputValue = $(this).val();
            if (inputValue.trim() === '') {
                clearErrors();
            } else {
                try {
                    JSON.parse(inputValue);
                    clearErrors();
                } catch (error) {
                    handleInvalidJSON(error);
                }
            }
        });

        function saveFormattedJSON() {
            const jsonInput = $('#jsonInput').val();
            if (jsonInput.trim() === '') {
                return;
            }

            try {
                const parsedJSON = JSON.parse(jsonInput);
                const formattedJSON = JSON.stringify(parsedJSON, null, 2);

                // Create a blob containing the formatted JSON
                const blob = new Blob([formattedJSON], { type: 'application/json' });

                // Create a link element to download the JSON
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'formatted_json.json';
                document.body.appendChild(a);
                a.click();

                // Clean up
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showMessage('JSON saved successfully!');
            } catch (error) {
                console.error('Error saving JSON: ', error);
                showMessage('Failed to save JSON.');
            }
        }

    </script>
</body>

</html>
